<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jours</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Jours">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jours">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jours">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jours</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">可能是一名node程序员</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="http://jours.cc">关于</a>
        
          <a class="main-nav-link" href="http://blog.csdn.net/xi__long">旧博客</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-前端路线?" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/19/前端路线?/" class="article-date">
  <time datetime="2017-06-19T02:02:51.000Z" itemprop="datePublished">2017-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/19/前端路线?/">前端路线</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>写给某辉看的 路线。</p>
<h1 id="css"><a href="#css" class="headerlink" title="css"></a>css</h1><ol>
<li>熟悉常用的css. <a href="http://www.w3school.com.cn/css/index.asp" target="_blank" rel="external">http://www.w3school.com.cn/css/index.asp</a></li>
<li>熟悉常用的布局和flexBox <a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a></li>
<li>了解 scss或者 less <a href="http://www.ruanyifeng.com/blog/2012/06/sass.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2012/06/sass.html</a></li>
<li>了解bootstrap</li>
</ol>
<h1 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h1><p>明白语法，熟悉dom和bom，能写一些动画或者特效</p>
<ol>
<li>教程 看完基本能入门 （看完1-8章(web API)就差不多了） <a href="http://javascript.ruanyifeng.com/" target="_blank" rel="external">http://javascript.ruanyifeng.com/</a></li>
<li>了解ES6（作用域，Promise，Class等  <a href="http://es6.ruanyifeng.com/" target="_blank" rel="external">http://es6.ruanyifeng.com/</a></li>
</ol>
<h1 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h1><ol>
<li>了解一些HTML5 的API </li>
<li>熟悉Ajax，Fetch API</li>
<li>能够写一些pc页面，移动页面，响应式的页面</li>
</ol>
<h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><p>了解一些排序算法（冒泡，快速排序等），这是最常见的<br>其他的可以以后再学习</p>
<h1 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h1><p>Vue.js 或者 React.js 学习一个(也可以都学，vue相对简单，）</p>
<ol>
<li>了解如何组件化开发</li>
<li>熟悉生命周期</li>
<li>熟悉路由</li>
<li>了解渲染机制</li>
<li>服务端渲染（可以跳过）<br>vue教程：<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="external">https://cn.vuejs.org/v2/guide/</a> （中文的<br>了解一些UI框架，比如 基于Vue 的 Element，基于React 的Antd<br>学完之后，写一个 后面提到的 社区的客户端就差不多了</li>
</ol>
<h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><ol>
<li>入门教程：<a href="https://cnodejs.org/topic/581b0c4ebb9452c9052e7acb" target="_blank" rel="external">https://cnodejs.org/topic/581b0c4ebb9452c9052e7acb</a> 这是一个完成的博客系统，可以学习Node.js ，也可以复习一下前端</li>
<li>express.js （中文文档，<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank" rel="external">http://www.expressjs.com.cn/guide/routing.html</a><br>只需了解一下，比如简单的RESTFUL 风格的api， 比如文件服务器</li>
<li>一些爬虫？简单的页面数据爬取 (可以跳过</li>
</ol>
<h1 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h1><ol>
<li>了解Webpack ，能够搭建babel转译，server就可以，不用了解如何运作的</li>
<li>了解scss或者less</li>
</ol>
<h1 id="一些项目"><a href="#一些项目" class="headerlink" title="一些项目"></a>一些项目</h1><ol>
<li>社区的客户端，比如v2ex，cnodejs的社区，有提供api，可以写一个客户端<br><a href="https://cnodejs.org/topic/565c4473d0bc14ae279399fe" target="_blank" rel="external">https://cnodejs.org/topic/565c4473d0bc14ae279399fe</a><br>可以照着样子来，可以抄代码。</li>
<li>移动端的页面，可以写一些在移动端的页面，像天猫，京东里面的活动页面</li>
<li>上面提到的 博客。</li>
</ol>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ol>
<li>vue 的vuex，react的Redux</li>
<li>微信小程序</li>
<li>自己写基础组件库</li>
<li>算法（有时间就多学</li>
<li>数据库的简单的增删改查（Mysql，MongoDB等</li>
<li>Hero 搭建一个主页</li>
<li>基于websocket(socket.io) 的聊天室，在线五子棋等</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/19/前端路线?/" data-id="cj43j9p3b000531389l92jmz1" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端-Node-js/">前端,Node.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Meteor.js快速接触" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/03/Meteor.js快速接触/" class="article-date">
  <time datetime="2017-05-02T16:00:00.000Z" itemprop="datePublished">2017-05-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/03/Meteor.js快速接触/">Meteor.js快速接触</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Meteor"><a href="#Meteor" class="headerlink" title="Meteor"></a>Meteor</h2><p>基于Node.js的一个框架。特点：实时数据（基于Websocket），客户端和服务端可以共享代码，很重。</p>
<p>本文主要讲几个模块：Collection，Methods，Pub／Sub，DDP<br>适合人群： 未接触过Meteor或接触不超过一个星期</p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="安装-Meteor"><a href="#安装-Meteor" class="headerlink" title="安装 Meteor"></a>安装 Meteor</h3><p><code>$ curl https://install.meteor.com | sh</code><br>创建新的应用<br><code>meteor create [APPNAME]</code><br>安装包<br><code>meteor npm install</code></p>
<h3 id="Meteor的文件结构"><a href="#Meteor的文件结构" class="headerlink" title="Meteor的文件结构"></a>Meteor的文件结构</h3><p>也是限制地比较死，最外层的文件结构<br>/client 客户端代码<br>/imports 外部引用代码<br>/server 服务端代码<br>/lib 一些全局的可以在这里声明</p>
<h3 id="文件加载顺序"><a href="#文件加载顺序" class="headerlink" title="文件加载顺序"></a>文件加载顺序</h3><ul>
<li>同一层级下，以文件名的字母顺序载入，有时候需要为了这个改文件名。。</li>
<li>先载入<code>／lib</code>下的文件</li>
</ul>
<h2 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h2><p><code>isClient, isServer</code>来判断时客户端还是服务端，可以分别开来执行<br><code>isDevelopment, isProduction</code>来判断开发环境还是线上环境<br><code>settings</code>配置文件<br>这些都是全局的，使用类似<br><code>Meteor.setting</code>，<code>Meteor.isClient</code></p>
<h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>一般来说，Collection的声明是共用的，所以不在<code>client</code>也不再<code>server</code>中。<br>Meteor.js内部集成了MongoDB，好像目前也只支持MongoDB，若要结合其他，可以发起HTTP，DDP，RPC等（后续讲到）<br>创建一个集合，注意：这里的Mongo是全局变量<br><code>Post = new Mongo.Collection(&#39;post&#39;)</code><br>在客户端和服务端中，都有这个概念，虽然定义的语句相同，但是实际的意义却是不同。它们通过（Pub／Sub）来对数据进行同步。<br>其CURD的操作和MongoDB的语法一致，比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.posts.insert(&#123;title: &quot;A new post&quot;&#125;);</span><br><span class="line"></span><br><span class="line">&gt; db.posts.find();</span><br><span class="line">&#123; &quot;_id&quot;: ObjectId(&quot;..&quot;), &quot;title&quot; : &quot;A new post&quot;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>客户端集合<br>客户端的集合更加有趣。当你在客户端申明 Posts = new Mongo.Collection(‘posts’); 你实际上是创建了一个本地的，在浏览器缓存中的真实的 Mongo 集合。 当我们说客户端集合被”缓存”是指它保存了你数据的一个子集，而且对这些数据提供了十分快速的访问。</p>
<p>有一点我们必须要明白，因为这是 Meteor 工作的一个基础: 通常说来，客户端的集合的数据是你 Mongo 数据库的所有数据的一个子集（毕竟我们不会想把整个数据库的数据全传到客户端来）。</p>
<p>第二，那些数据是被存储在浏览器内存中的，也就是说访问这些数据几乎不需要时间，不像去服务器访问 Posts.find() 那样需要等待，因为数据事实上已经载入了。</p>
<p>在 Meteor 中，find() 返回值是一个游标。游标是一种从动数据源。如果你想输出内容，你可以对游标使用 fetch() 来把游标转换成数组。</p>
<h2 id="发布与订阅"><a href="#发布与订阅" class="headerlink" title="发布与订阅"></a>发布与订阅</h2><p>发布与订阅用语客户端与服务端的数据交互，基本上是实时性比较高的数据才使用。<br>简单的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务器端</span></span><br><span class="line">Meteor.publish(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Posts.find(&#123;flagged: <span class="literal">false</span>&#125;); </span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 在客户端</span></span><br><span class="line">Meteor.subscribe(<span class="string">'posts'</span>, <span class="string">'bob-smith'</span>);</span><br></pre></td></tr></table></figure></p>
<p>如果需要使用多个集合，可以选择使用<code>publish-composite</code> 。<br>使用命令 <code>meteor add reywood:publish-composite</code>安装，一个简单的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Meteor.publishComposite(<span class="string">"userCommentsComposite"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">userId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 根据用户 Id 查询出该用户所有的评论集合，注意这里是集合</span></span><br><span class="line">      <span class="keyword">return</span> Comment.collection.find(&#123;userId: userId&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        find: <span class="function"><span class="keyword">function</span>(<span class="params">comment</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 遍历查询出来的评论集合中所有信息，根据每一条评论关联的文章 Id 查询文章数据</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"Get activityId by commantId : commandId ="</span>, comment._id, <span class="string">" commandLinkObjectId ="</span>, comment.linkedObjectId);</span><br><span class="line">          <span class="keyword">return</span> Activities.find(&#123;_id: comment.linkedObjectId&#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            find: <span class="function"><span class="keyword">function</span>(<span class="params">activity</span>) </span>&#123;</span><br><span class="line">              <span class="comment">// 查询该文章所有的点赞信息</span></span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">"Get like info by activityId :"</span>, activity._id);</span><br><span class="line">              <span class="keyword">return</span> Like.collection.find(&#123;linkedObjectId: activity._id&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            find: <span class="function"><span class="keyword">function</span>(<span class="params">activity</span>) </span>&#123;</span><br><span class="line">              <span class="comment">// 查询该文章的作者信息</span></span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">"Get activity user info by activity.userId :"</span>, activity.userId);</span><br><span class="line">              <span class="keyword">return</span> Meteor.users.find(&#123;_id: activity.userId&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>其具体实现有点类似，Promise.then(data=&gt;{})的实现，也是数据一层层传递给<code>children</code></p>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h2><p>Meteor不像普通的web框架是通过req／res的方式来操作数据，也就没有最近流行的RESTFUL的风格，客户端请求服务端的数据，可以通过Methods来实现，可以理解为Req／Res。<br>在服务端和客户端都可以</p>
<h3 id="创建Methods"><a href="#创建Methods" class="headerlink" title="创建Methods"></a>创建Methods</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Meteor.methods(&#123;</span><br><span class="line">    say: () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    walk: () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="调用Methods"><a href="#调用Methods" class="headerlink" title="调用Methods"></a>调用Methods</h3><p>客户端和服务端都可以调用Methods，只是服务端只能调用服务端的，而客户端可以都可以，并优先调用服务端的（即同时存在服务端声明的Methods和客户端声明的Methods时，调用的时候为服务端的）。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Method.call 或者 Method.apply ,区别和js类似，就是参数的不同。</span></span><br><span class="line">Meteor.apply(<span class="string">"test"</span>,[<span class="number">1</span>,<span class="number">2</span>],<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="Meteor-methods中函数的上下文对象-this"><a href="#Meteor-methods中函数的上下文对象-this" class="headerlink" title="Meteor.methods中函数的上下文对象 this"></a>Meteor.methods中函数的上下文对象 this</h3><ol>
<li>this.userId<br>调用这个函数的用户的id ，类型：string。如果用户没有登录，值为null。 该属性在 Server的Meteor.methods和Client的Meteor.methods都存在。用官方的描述就是Anywhere。 这个属性依赖Meteor的accounts 模块。</li>
<li>this.unblock()<br>On the server, methods from a given client run one at a time. The N+1th invocation from a client won’t start until the Nth invocation returns. However, you can change this by calling this.unblock. This will allow the N+1th invocation to start running in a new fiber.</li>
</ol>
<h2 id="DDP"><a href="#DDP" class="headerlink" title="DDP"></a>DDP</h2><p>这个类只有个方法 <code>DDP.connect(url)</code>。DDP可以认为是一个类似RPC的实现，对于不同的开发语言，也有对应的包。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> remote =  DDP.connect(<span class="string">"http://localhost:3010"</span>);<span class="comment">//链接远程服务器</span></span><br><span class="line">remote.methods(&#123;</span><br><span class="line">    say:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">"hello world"</span>)&#125;</span><br><span class="line">&#125;) <span class="comment">//这就是定义远程调用的存根。</span></span><br><span class="line"></span><br><span class="line">remote.call(<span class="string">"say"</span>,<span class="string">"deputy"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;) <span class="comment">//调用远程方法</span></span><br></pre></td></tr></table></figure></p>
<h2 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a>其他模块</h2><h3 id="check"><a href="#check" class="headerlink" title="check"></a>check</h3><p>check是一个类型验证的库，如<br><code>check(userid, String);</code></p>
<h3 id="accounts"><a href="#accounts" class="headerlink" title="accounts"></a>accounts</h3><p>直接使用的账户功能，可以配合Role，简单地实现权限管理。</p>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>meteor内置了HTTP的包，使用<br><code>Http.call(method,url, [options], [asyncCallback])</code></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Meteor.js这个框架很重，虽然提供了很多功能，但是写起来比较不灵活。<br>适合一个人干完前端和服务端的工作。<br>熟悉koa或者express的人可能在刚接触的时候比较难以接受，希望此文能有一定的帮助</p>
<p>参考：<br>Meteor 组合订阅包 publish-composite 使用 <a href="http://www.mycode.net.cn/language/javascript/1195.html" target="_blank" rel="external">http://www.mycode.net.cn/language/javascript/1195.html</a><br>Discover Meteor <a href="http://wiki.jikexueyuan.com/project/discover-meteor/publish-and-subscribe.html" target="_blank" rel="external">http://wiki.jikexueyuan.com/project/discover-meteor/publish-and-subscribe.html</a><br>实时开发框架Meteor API解读系列&lt;一&gt; Meteor.methods <a href="http://blog.csdn.net/a6383277/article/details/18098929" target="_blank" rel="external">http://blog.csdn.net/a6383277/article/details/18098929</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/03/Meteor.js快速接触/" data-id="cj43j9p2z000131381to0tnlh" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js-MongoDB/">Node.js,MongoDB</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Redis-Action" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/13/Redis-Action/" class="article-date">
  <time datetime="2017-04-12T16:00:00.000Z" itemprop="datePublished">2017-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/13/Redis-Action/">Redis在用户数据统计中的简单应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在项目的基本功能开发完成之后，有一个对用户的数据的统计需求。用于分析和查看应用的相关数据。正好之前看到过有用Redis统计的例子，便开始慢慢摸索。（可能本篇文章内的并不是最佳实践，总要踩坑，优化嘛。。。）</p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>Redis是一个优秀的K-V数据库，Redis的所有数据都是存放在内存中的，</p>
<p>Redis是用C语言实现的，一般来说C语言实现的程序“距离”操作系统更近，执行速度相对会更快。 </p>
<p>Redis使用了单线程架构，预防了多线程可能产生的竞争问题。</p>
<p>Redis有一些非常实用的数据结构，如：String，Set，Hash，List，Zset，方便使用。</p>
<h2 id="统计的项目需求"><a href="#统计的项目需求" class="headerlink" title="统计的项目需求"></a>统计的项目需求</h2><ul>
<li>每日新注册用户</li>
<li>每日登录用户</li>
<li>每个时段的在线人数</li>
<li>平均在线</li>
<li>最高在线  </li>
<li>充值人数</li>
<li>新增充值人数</li>
<li>充值金额</li>
<li>N日留存</li>
<li>N日ARPU<br>等。。</li>
</ul>
<h2 id="Redis设计"><a href="#Redis设计" class="headerlink" title="Redis设计"></a>Redis设计</h2><p>基于上面的一些需求，在数据类型上可以分成两类</p>
<ol>
<li>累计类型</li>
<li>新增数据（涉及到集合的运算）<br>在数据统计上，也可以分成两类</li>
<li>每日的数据</li>
<li>从开始起就统计的数据</li>
</ol>
<h3 id="Key设计"><a href="#Key设计" class="headerlink" title="Key设计"></a>Key设计</h3><p>于是可以对键进行设计，Redis是内存数据库，所以对于键的长度也不能忽视，可以采用缩写</p>
<p>我这里采用 [areaName]:[date]:[type]的格式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*数据类型*/</span></span><br><span class="line"><span class="keyword">const</span> ValueType = &#123;</span><br><span class="line">    <span class="string">'newPlayer'</span>: <span class="string">'np'</span>,</span><br><span class="line">    <span class="string">'chargeAmount'</span>: <span class="string">'cA'</span>,...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*生成Redis Key*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initRedisKey</span>(<span class="params">area, type, time</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="string">'all'</span></span><br><span class="line">    <span class="keyword">if</span>(time) &#123;</span><br><span class="line">        date = moment().format(<span class="string">'YYYYMMDD'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;area&#125;</span>:<span class="subst">$&#123;date&#125;</span>:<span class="subst">$&#123;ValueType[type]&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Value设计"><a href="#Value设计" class="headerlink" title="Value设计"></a>Value设计</h2><ol>
<li><p>对于累加类型的数据，可以使用<code>String</code>,比如：每日消耗的金币，每日注册人数等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">incrbyKey</span>(<span class="params">key, num</span>) </span>&#123;</span><br><span class="line">    cache.incrby(key, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于需要计算唯一性的数据，比如登录用户，充值人数等，不能继续使用 <code>String</code>,可以选用的有<code>Set</code>,<code>Hash</code>，<code>bitmap</code>等。<br>考虑到平均下来每个服务器分担的用户可能只在万级左右，并且在线人数统计要频繁地统计长度，最后选择了使<code>Set</code>来对这些数据统计。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cache.sadd(uid, uid) <span class="comment">//用户上线</span></span><br><span class="line">cache.srem(uid) <span class="comment">//用户下线</span></span><br><span class="line">cache.scard(key）<span class="comment">//这个key的长度</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在计算每小时平均在线的时候，使用<code>String</code>来存储，后续只要对字符串进行格式化，即可方便地计算出每小时平均在线，每小时最高在线，整天的数据。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">calOnlinePlayerNum</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> hour = New <span class="built_in">Date</span>().getHours()</span><br><span class="line">    <span class="keyword">let</span> num = <span class="keyword">yield</span> cache.scard(key1)</span><br><span class="line">    cache.append(key2, <span class="string">`-<span class="subst">$&#123;hour&#125;</span>:<span class="subst">$&#123;num&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">schedule(</span><br><span class="line">    co(calOnlinePlayerNum)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ol>
<li>新增的数据计算<br>这一类要记录的数据可能比较多，因为涉及到集合的交集，并集计算，一开始想到的就是<code>Set</code>,又考虑到内存的问题，便将目光转移到<code>bitmap</code>上。<br><code>bitmap</code>有点hash位的感觉，如<code>1000 0001</code>，就可以表示uid为8，0 的用户今天登录过。<br>如果uid时1000000开始的，可以对其切割（减去初始uid）。在第一次setbit的时候，Redis要对其开一个较大的内存，可能会影响性能。</li>
</ol>
<p>比如记录留存率：<br>记录每天的新注册的id。[area]:[date]:[type]<br>记录每天的登录用户id。[area]:[date]:[type]</p>
<p>A日的N日留存率=（A日之后第N天登录过游戏的并且这些用户是在A日新登录的用户数）/（A日新登录的玩家用户数）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cache.setbit(key, uid, <span class="number">1</span>)</span><br><span class="line"><span class="comment">//====================//</span></span><br><span class="line">cache.bitop(<span class="string">'and'</span> , destKey, key1, key2) <span class="comment">//计算交集</span></span><br><span class="line"><span class="keyword">let</span> a = cache.bitcount(key1) || <span class="number">1</span> </span><br><span class="line"><span class="keyword">let</span> b = cache.bitcount(destKey) <span class="comment">// 交集的长度</span></span><br><span class="line">per = b/a</span><br></pre></td></tr></table></figure>
<h2 id="持久化数据"><a href="#持久化数据" class="headerlink" title="持久化数据"></a>持久化数据</h2><p>虽然Redis本身也有持久化的功能，但显然这是不划算的，对于每天统计的保存在Redis中的数据，可能有些数据第二天就不需要继续存在Redis里面了，所以，可以选择数据库，将数据持久化到磁盘。<br>对于每天的数据，可以在统计完之后就删除，<br>对于N天的需要统计计算的数据，可以在最后一天进行删除操作。<br>本文使用MongoDB，MongoDB的一个优势就是对JSON的友好。在次日对Redis中的数据进行一定的分类，计算，对数据进行持久化。以date为索引，可以方便后台的以日期为单位进行查询。</p>
<h2 id="小节"><a href="#小节" class="headerlink" title="小节"></a>小节</h2><p>Redis因其提供的数据结构，使得使用起来非常方便，对于不同的需求，可以有多种的实现方式。<br>但是对于性能和内存的占用还是要有比较多的考虑，<br>本文只是结合一些资料的探索，可能还存在一些不足的地方，希望在实践中能够进行优化。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>《Redis开发与运维》</li>
<li>《Redis实战》</li>
</ul>
<h2 id="附：-常见的Redis的操作的复杂度"><a href="#附：-常见的Redis的操作的复杂度" class="headerlink" title="附： 常见的Redis的操作的复杂度"></a>附： 常见的Redis的操作的复杂度</h2><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>set o(1)</p>
<p>get o(1)</p>
<p>del o(n)</p>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>sadd o(1)</p>
<p>sismember o(1)</p>
<p>srem   o(n) n is the number of members to be removed</p>
<p>smembers  O(N) where N is the set cardinality</p>
<p>scard o(1)</p>
<h3 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h3><p>zadd  O(log(N)) for each item added, where N is the number of elements in the sorted set.</p>
<p>zrange<br>O(log(N)+M) with N being the number of elements in the sorted set and M the number of elements returned.</p>
<p>zrem<br>O(M*log(N)) with N being the number of elements in the sorted set and M the number of elements to be removed.<br>zrangebyscore<br>O(log(N)+M) with N being the number of elements in the sorted set and M the number of elements being returned. If M is constant (e.g. always asking for the first 10 elements with LIMIT), you can consider it O(log(N)).</p>
<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>hset o(1)</p>
<p>hget o(1)</p>
<h3 id="bitmap"><a href="#bitmap" class="headerlink" title="bitmap"></a>bitmap</h3><p>bitcount o(n)</p>
<p>bitop o(n)</p>
<p>setbit o(1)</p>
<p>getbit o(1)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/04/13/Redis-Action/" data-id="cj43j9p3300023138ublihuil" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis-MongoDB/">Redis,MongoDB</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript-Puzzlers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/19/JavaScript-Puzzlers/" class="article-date">
  <time datetime="2016-06-18T16:02:51.000Z" itemprop="datePublished">2016-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/19/JavaScript-Puzzlers/">JavaScript Puzzlers!</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaScript-Puzzlers"><a href="#JavaScript-Puzzlers" class="headerlink" title="JavaScript Puzzlers!"></a>JavaScript Puzzlers!</h1><h2 id="or-do-you-really-know-JavaScript"><a href="#or-do-you-really-know-JavaScript" class="headerlink" title="or: do you really know JavaScript?"></a>or: do you really know JavaScript?</h2><p>(or: how insane do you think JavaScript actually is?)</p>
<h2 id="let’s-start"><a href="#let’s-start" class="headerlink" title="let’s   start "></a>let’s  <a href="http://javascript-puzzlers.herokuapp.com/" target="_blank" rel="external"> start </a></h2><p>下面是我做题后的一个总结和归纳(可能解释不是很标准)</p>
<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">[<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>].map(<span class="built_in">parseInt</span>)</span><br></pre></td></tr></table></figure>
<p>what you actually get is [1, NaN, NaN] because parseInt takes two parameters (val, radix) and map passes 3 (element, index, array)</p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">[<span class="keyword">typeof</span> <span class="literal">null</span>, <span class="literal">null</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>]</span><br></pre></td></tr></table></figure>
<p>答案: [“object”, false]<br>因为历史遗留问题,typeof null 返回object.<br>instanceof运算符可以用来判断某个构造函数的prototype属性所指向的對象是否存在于另外一个要检测对象的原型链上。<br>我们可以通过obj.<strong>proto</strong> 来进行修改 (自己写的对象<br>null 是没有prototype 的属性</p>
<h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">[ [<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>].reduce(<span class="built_in">Math</span>.pow), [].reduce(<span class="built_in">Math</span>.pow) ]</span><br></pre></td></tr></table></figure>
<p>答案: 9, error (当然,会直接报错..)<br>reduce() 方法接收一个函数作为累加器（accumulator），数组中的每个值（从左到右）开始合并，最终为一个值。<br>该方法的参数是一个callback, 一个[作为第一次调用callback的参数],<br>如果arr为空,则直接报错,TypeError<br>另: reduce可用于数组求和,数组扁平化等.</p>
<h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> val = <span class="string">'smtg'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Value is '</span> + (val === <span class="string">'smtg'</span>) ? <span class="string">'Something'</span> : <span class="string">'Nothing'</span>);</span><br></pre></td></tr></table></figure>
<p>答案: Something<br><code>+</code> 的优先级要高,所以来不及三目运算, 前面这段就相当于一个变量, 所以在计算三目的时候,返回’Something’</p>
<h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'World!'</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> name = <span class="string">'Jack'</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Goodbye '</span> + name);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>答案: Goodbye Jack<br>变量提升,所以在第一句的if时, name 是为undefined,直到var name 才被定义</p>
<h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> END = <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>);</span><br><span class="line"><span class="keyword">var</span> START = END - <span class="number">100</span>;</span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = START; i &lt;= END; i++) &#123;</span><br><span class="line">    count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(count);</span><br></pre></td></tr></table></figure>
<p>别直接在控制台跑这段代码(别问我为什么直到 - -$)<br>摘自 ruanyifeng(<a href="http://javascript.ruanyifeng.com/grammar/number.html#toc3" target="_blank" rel="external">链接</a>)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">根据国际标准IEEE <span class="number">754</span>，JavaScript浮点数的<span class="number">64</span>个二进制位，从最左边开始，是这样组成的。</span><br><span class="line"></span><br><span class="line">第<span class="number">1</span>位：符号位，<span class="number">0</span>表示正数，<span class="number">1</span>表示负数</span><br><span class="line">第<span class="number">2</span>位到第<span class="number">12</span>位：储存指数部分</span><br><span class="line">第<span class="number">13</span>位到第<span class="number">64</span>位：储存小数部分（即有效数字）</span><br><span class="line">符号位决定了一个数的正负，指数部分决定了数值的大小，小数部分决定了数值的精度。</span><br><span class="line"></span><br><span class="line">IEEE <span class="number">754</span>规定，有效数字第一位默认总是<span class="number">1</span>，不保存在<span class="number">64</span>位浮点数之中。也就是说，有效数字总是<span class="number">1.</span>xx...xx的形式，其中xx..xx的部分保存在<span class="number">64</span>位浮点数之中，最长可能为<span class="number">52</span>位。因此，JavaScript提供的有效数字最长为<span class="number">53</span>个二进制位。</span><br><span class="line"></span><br><span class="line">(<span class="number">-1</span>)^符号位 * <span class="number">1.</span>xx...xx * <span class="number">2</span>^指数位</span><br><span class="line">上面公式是一个数在JavaScript内部实际的表现形式。</span><br><span class="line"></span><br><span class="line">精度最多只能到<span class="number">53</span>个二进制位，这意味着，绝对值小于<span class="number">2</span>的<span class="number">53</span>次方的整数，即-(<span class="number">2</span>^<span class="number">53</span><span class="number">-1</span>)到<span class="number">2</span>^<span class="number">53</span><span class="number">-1</span>，都可以精确表示。</span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>)</span><br><span class="line"><span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">1</span></span><br><span class="line"><span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">2</span></span><br><span class="line"><span class="comment">// 9007199254740994</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">3</span></span><br><span class="line"><span class="comment">// 9007199254740996</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">4</span></span><br><span class="line"><span class="comment">// 9007199254740996</span></span><br><span class="line">从上面示例可以看到，大于<span class="number">2</span>的<span class="number">53</span>次方以后，整数运算的结果开始出现错误。所以，大于等于<span class="number">2</span>的<span class="number">53</span>次方的数值，都无法保持精度。</span><br><span class="line"></span><br><span class="line"><span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>)</span><br><span class="line"><span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多出的三个有效数字，将无法保存</span></span><br><span class="line"><span class="number">9007199254740992111</span></span><br><span class="line"><span class="comment">// 9007199254740992000</span></span><br><span class="line">上面示例表明，大于<span class="number">2</span>的<span class="number">53</span>次方以后，多出来的有效数字（最后三位的<span class="number">111</span>）都会无法保存，变成<span class="number">0</span>。</span><br></pre></td></tr></table></figure></p>
<h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> ary = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line">ary[<span class="number">10</span>] = <span class="number">10</span>;</span><br><span class="line">ary.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x === <span class="literal">undefined</span>;&#125;);</span><br></pre></td></tr></table></figure>
<p>答案: []<br>filter() 方法使用指定的函数测试所有元素，并创建一个包含所有通过测试的元素的新数组。<br>即所谓的过滤函数.<br>执行到第二句的时候 , <code>ary = [0, 1, 2, undefined * 7, 10]</code><br>Array.prototype.filter is not invoked for the missing elements<br>另:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ary = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>, <span class="literal">undefined</span>];</span><br><span class="line">ary[<span class="number">10</span>] = <span class="number">10</span>;</span><br><span class="line">ary.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x === <span class="literal">undefined</span>;&#125;);</span><br><span class="line"><span class="comment">// --&gt; [undefined]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8"><a href="#8" class="headerlink" title="8"></a>8</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> two   = <span class="number">0.2</span></span><br><span class="line"><span class="keyword">var</span> one   = <span class="number">0.1</span></span><br><span class="line"><span class="keyword">var</span> eight = <span class="number">0.8</span></span><br><span class="line"><span class="keyword">var</span> six   = <span class="number">0.6</span></span><br><span class="line">[two - one == one, eight - six == two]</span><br></pre></td></tr></table></figure>
<h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showCase</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(value) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Case A'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Case B'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">undefined</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'undefined'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Do not know!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">showCase(<span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'A'</span>));</span><br></pre></td></tr></table></figure>
<p>答案: Do not know!<br>switch uses === internally and new String(x) !== x</p>
<h3 id="10"><a href="#10" class="headerlink" title="10"></a>10</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showCase2</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(value) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'A'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Case A'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'B'</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Case B'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">undefined</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'undefined'</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Do not know!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">showCase2(<span class="built_in">String</span>(<span class="string">'A'</span>));</span><br></pre></td></tr></table></figure>
<p>答案: Case A<br>String(x) does not create an object but does return a string, i.e. typeof String(1) === “string”</p>
<h3 id="11"><a href="#11" class="headerlink" title="11"></a>11</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isOdd</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEven</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSane</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isEven(num) || isOdd(num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> values = [<span class="number">7</span>, <span class="number">4</span>, <span class="string">'13'</span>, <span class="number">-9</span>, <span class="literal">Infinity</span>];</span><br><span class="line">values.map(isSane);</span><br></pre></td></tr></table></figure>
<p>答案: [true, true, true, false, false]<br>Infinity % 2 gives NaN, -9 % 2 gives -1 (modulo operator keeps sign so it’s result is only reliable compared to 0)</p>
<h3 id="12"><a href="#12" class="headerlink" title="12"></a>12</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">8</span>)</span><br><span class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">parseInt</span>(<span class="number">3</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>答案: 3, NaN, 3</p>
<h3 id="13"><a href="#13" class="headerlink" title="13"></a>13</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'5'</span> + <span class="number">3</span></span><br><span class="line"><span class="string">'5'</span> - <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>答案: “53”, 2<br>javascript 的隐式转换,</p>
<h3 id="14"><a href="#14" class="headerlink" title="14"></a>14</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="number">1</span> + - + + + - + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>答案: 2</p>
<h3 id="15"><a href="#15" class="headerlink" title="15"></a>15</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> ary = <span class="built_in">Array</span>(<span class="number">3</span>);</span><br><span class="line">ary[<span class="number">0</span>]=<span class="number">2</span></span><br><span class="line">ary.map(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>) </span>&#123; <span class="keyword">return</span> <span class="string">'1'</span>; &#125;);</span><br></pre></td></tr></table></figure>
<p>答案:  [“1”, undefined × 2]<br>上面提到过,对为初始化的不起作用</p>
<h3 id="16"><a href="#16" class="headerlink" title="16"></a>16</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sidEffecting</span>(<span class="params">ary</span>) </span>&#123;</span><br><span class="line">  ary[<span class="number">0</span>] = ary[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a,b,c</span>) </span>&#123;</span><br><span class="line">  c = <span class="number">10</span>;</span><br><span class="line">  sidEffecting(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line">bar(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>答案: 21<br>arguments 对象并不是一个真正的Array。它类似于数组，但没有数组所特有的属性和方法，除了 length.<br>in javascript variables are tied to the arguments object so changing the variables changes arguments and changing arguments changes the local variables even when they are not in the same scope.<br>在js中,变量和arguments 是绑定在一起的,所以改变了变量就是改变了arguments,改变了arguments 改变了当前的变量 ,及时不是在相同的作用域内.</p>
<h3 id="17"><a href="#17" class="headerlink" title="17"></a>17</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">111111111111111110000</span>,</span><br><span class="line">    b = <span class="number">1111</span>;</span><br><span class="line">a + b;</span><br></pre></td></tr></table></figure>
<p>同 第六题</p>
<h3 id="18"><a href="#18" class="headerlink" title="18"></a>18</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> x = [].reverse;</span><br><span class="line">x();</span><br></pre></td></tr></table></figure>
<p>答案: VM1357:2 Uncaught TypeError: Array.prototype.reverse called on null or undefined(…)<br>暂时不知道怎么解释.</p>
<h3 id="19"><a href="#19" class="headerlink" title="19"></a>19</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MIN_VALUE &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>答案: false</p>
<p>在调试工具中为 5e-324, Number.MIN_VALUE 是最小的大于0的数</p>
<h3 id="20"><a href="#20" class="headerlink" title="20"></a>20</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">[<span class="number">1</span> &lt; <span class="number">2</span> &lt; <span class="number">3</span>, <span class="number">3</span> &lt; <span class="number">2</span> &lt; <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>答案: [true, true]</p>
<p>相同运算符优先级相等,故原来的式子相当于 [(1 &lt; 2) &lt; 3, (3 &lt; 2) &lt; 1]<br>其中存在隐式转换 true -&gt; 1, false -&gt; 0</p>
<h3 id="21"><a href="#21" class="headerlink" title="21"></a>21</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="comment">// the most classic wtf</span></span><br><span class="line"><span class="number">2</span> == [[[<span class="number">2</span>]]]</span><br></pre></td></tr></table></figure>
<p>答案: true<br>如果我们这样赋值  <code>var a = [[[2]]]</code> 相当于 <code>a[0][0] = [2]  a[0][0][0] = 2</code><br>== 比较的是值 ,故返回 true</p>
<h3 id="22"><a href="#22" class="headerlink" title="22"></a>22</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="number">3.</span>toString()</span><br><span class="line"><span class="number">3.</span>.toString()</span><br><span class="line"><span class="number">3.</span>..toString()</span><br></pre></td></tr></table></figure>
<p>答案:  error, “3”, error</p>
<p>摘自stackoverflow: That is because when JavaScript sees a period after an integer, it assumes the value after it will be its decimals. Because of that, simply using 5.toString() will make JavaScript find toString where it expected numbers.<br>当javascript遇到整数后面带有小数点,为认为后面的是这个数的小数部分,所以<code>3.toString()</code> 当然 当申明一个变量a,赋值为3的时候,a.toString() 是可行的</p>
<h3 id="23"><a href="#23" class="headerlink" title="23"></a>23</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = y = <span class="number">1</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log(y);</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
<p>答案: 1, error</p>
<p>这题在考作用域的时候经常考到, <code>var x = y = 1;</code> 相当于 <code>y = 1; var x = y;</code> 所以在这里y 是全局变量,而x只在这个函数里面,<br>所以log(y) 为 1, x 就是<code>is not defined</code></p>
<h3 id="24"><a href="#24" class="headerlink" title="24"></a>24</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = <span class="regexp">/123/</span>,</span><br><span class="line">    b = <span class="regexp">/123/</span>;</span><br><span class="line">a == b</span><br><span class="line">a === b</span><br></pre></td></tr></table></figure>
<p>答案: false, false</p>
<p>a,b 是正则表达式, 我们使用typeof 会发现它们都是object<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">摘自网络:</span><br><span class="line">先说 ===，这个比较简单。下面的规则用来判断两个值是否===相等：</span><br><span class="line"><span class="number">1</span>、如果类型不同，就[不相等]</span><br><span class="line"><span class="number">2</span>、如果两个都是数值，并且是同一个值，那么[相等]；(！例外)的是，如果其中至少一个是<span class="literal">NaN</span>，那么[不相等]。（判断一个值是否是<span class="literal">NaN</span>，只能用<span class="built_in">isNaN</span>()来判断）</span><br><span class="line"><span class="number">3</span>、如果两个都是字符串，每个位置的字符都一样，那么[相等]；否则[不相等]。</span><br><span class="line"><span class="number">4</span>、如果两个值都是<span class="literal">true</span>，或者都是<span class="literal">false</span>，那么[相等]。</span><br><span class="line"><span class="number">5</span>、如果两个值都引用同一个对象或函数，那么[相等]；否则[不相等]。</span><br><span class="line"><span class="number">6</span>、如果两个值都是<span class="literal">null</span>，或者都是<span class="literal">undefined</span>，那么[相等]。</span><br><span class="line">再说 ==，根据以下规则：</span><br><span class="line"><span class="number">1</span>、如果两个值类型相同，进行 === 比较。</span><br><span class="line"><span class="number">2</span>、如果两个值类型不同，他们可能相等。根据下面规则进行类型转换再比较：</span><br><span class="line">a、如果一个是<span class="literal">null</span>、一个是<span class="literal">undefined</span>，那么[相等]。</span><br><span class="line">b、如果一个是字符串，一个是数值，把字符串转换成数值再进行比较。</span><br><span class="line">c、如果任一值是 <span class="literal">true</span>，把它转换成 <span class="number">1</span> 再比较；如果任一值是 <span class="literal">false</span>，把它转换成 <span class="number">0</span> 再比较。</span><br><span class="line">d、如果一个是对象，另一个是数值或字符串，把对象转换成基础类型的值再比较。对象转换成基础类型，利用它的toString或者valueOf方法。 js核心内置类，会尝试valueOf先于toString；例外的是<span class="built_in">Date</span>，<span class="built_in">Date</span>利用的是toString转换。非js核心的对象，令说（比较麻 烦，我也不大懂）</span><br><span class="line">e、任何其他组合，都[不相等]。</span><br></pre></td></tr></table></figure></p>
<h3 id="25"><a href="#25" class="headerlink" title="25"></a>25</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">a ==  b</span><br><span class="line">a === b</span><br><span class="line">a &gt;   c</span><br><span class="line">a &lt;   c</span><br></pre></td></tr></table></figure>
<p>答案: false, false, false, true</p>
<p>解释同上, 数组在比较的时候,是按照字典序比较的, 故第四条的值为true,<br>另: 只要一次分出大小,直接返回结果,不看数组的大小,比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = [3];</span><br><span class="line">var b = [1, 2];</span><br><span class="line">a &gt; b // log true</span><br></pre></td></tr></table></figure></p>
<h3 id="26"><a href="#26" class="headerlink" title="26"></a>26</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;, b = <span class="built_in">Object</span>.prototype;</span><br><span class="line">[a.prototype === b, <span class="built_in">Object</span>.getPrototypeOf(a) === b]</span><br></pre></td></tr></table></figure>
<p>答案: [false, true]<br>Object.getPrototypeOf() 方法返回指定对象的原型（也就是该对象内部属性[[Prototype]]的值）。<br>a 是一个Object, Object中 除了Functions有prototype属性之外都没有, 所以 a.prototype = undefined;<br>Every Object instead has an internal property accessible via Object.getPrototypeOf</p>
<h3 id="27"><a href="#27" class="headerlink" title="27"></a>27</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> a = f.prototype, b = <span class="built_in">Object</span>.getPrototypeOf(f);</span><br><span class="line">a === b</span><br></pre></td></tr></table></figure>
<p>答案: false<br>f.prototype is the object that will become the parent of any objects created with new f while Object.getPrototypeOf returns the parent in the inheritance hierarchy.<br>在控制台中,a 是一个Object, b 是一个 function</p>
<h3 id="28"><a href="#28" class="headerlink" title="28"></a>28</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="keyword">var</span> oldName = foo.name;</span><br><span class="line">foo.name = <span class="string">"bar"</span>;</span><br><span class="line">[oldName, foo.name]</span><br></pre></td></tr></table></figure>
<p>答案: [“foo”, “foo”]<br>function.name 返回函数的名称.<br>Writable    no<br>Enumerable  no<br>Configurable yes<br>Note that in non-standard, pre-ES6 implementations the configurable attribute was false as well.<br>另: 当函数使用new Function(…) 或者 直接Function(…) 来创建的时候,其name属性为””, 如:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">  someMethod: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f.name == <span class="string">''</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(object.someMethod.name == <span class="string">''</span>); <span class="comment">// also true</span></span><br></pre></td></tr></table></figure></p>
<p>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name" target="_blank" rel="external"> 更多</a>)</p>
<h3 id="29"><a href="#29" class="headerlink" title="29"></a>29</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="string">"1 2 3"</span>.replace(<span class="regexp">/\d/g</span>, <span class="built_in">parseInt</span>)</span><br></pre></td></tr></table></figure>
<p>答案: “1 NaN 3”<br>String.prototype.replace invokes the callback function with multiple arguments where the first is the match, then there is one argument for each capturing group, then there is the offset of the matched substring and finally the original string itself. so parseInt will be invoked with arguments [1, 0], [2, 2], [3, 4].</p>
<p>replace() 方法使用一个替换值（replacement）替换掉一个匹配模式（pattern）在原字符串中某些或所有的匹配项，并返回替换后的字符串。这个替换模式可以是字符串或者RegExp（正则表达式），替换值可以是一个字符串或者一个函数。<br>str.replace(regexp|substr, newSubStr|function[, flags])<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数</span><br><span class="line">regexp</span><br><span class="line">一个 <span class="built_in">RegExp</span> 对象。该正则所匹配的内容会被第二个参数的返回值替换掉。</span><br><span class="line">substr</span><br><span class="line">一个要被 newSubStr 替换的字符串。</span><br><span class="line">newSubStr</span><br><span class="line">替换掉第一个参数在原字符串中的匹配部分。该字符串中可以内插一些特殊的变量名。</span><br><span class="line"><span class="function"><span class="keyword">function</span></span><br><span class="line">一个用来创建新子字符串的函数，该函数的返回值将替换掉第一个参数匹配到的结果。该函数的参数描述请参考 指定一个函数作为参数 小节。</span></span><br></pre></td></tr></table></figure></p>
<p>另:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"1 'av' 3"</span>.replace(<span class="regexp">/\d/g</span>,<span class="number">1</span>) <span class="comment">//--&gt;"1 'av' 1"</span></span><br><span class="line"><span class="string">"1 2 3"</span>.replace(<span class="regexp">/\d/g</span>,<span class="number">1</span>)   <span class="comment">//--&gt; "1 1 1"</span></span><br></pre></td></tr></table></figure></p>
<p>(<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace" target="_blank" rel="external"> 更多</a>)</p>
<h3 id="30"><a href="#30" class="headerlink" title="30"></a>30</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> parent = <span class="built_in">Object</span>.getPrototypeOf(f);</span><br><span class="line">f.name <span class="comment">// ?</span></span><br><span class="line">parent.name <span class="comment">// ?</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">eval</span>(f.name) <span class="comment">// ?</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">eval</span>(parent.name) <span class="comment">//  ?</span></span><br></pre></td></tr></table></figure>
<p>答案: “f”, “Empty”, “function”, error<br>The function prototype object is defined somewhere, has a name, can be invoked, but it’s not in the current scope.</p>
<h3 id="31"><a href="#31" class="headerlink" title="31"></a>31</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> lowerCaseOnly =  <span class="regexp">/^[a-z]+$/</span>;</span><br><span class="line">[lowerCaseOnly.test(<span class="literal">null</span>), lowerCaseOnly.test()]</span><br></pre></td></tr></table></figure>
<p>答案: [true, true]<br>该正则的意思就是符合所有的都是小写<br>而在函数test中,对于argument存在一个ToString的操作<br>故原来的式子等价于 .test(‘null’) , .test(‘undefined’)</p>
<h3 id="32"><a href="#32" class="headerlink" title="32"></a>32</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line">[,,,].join(<span class="string">", "</span>)</span><br></pre></td></tr></table></figure>
<p>答案: “, , “<br>join() 方法将数组中的所有元素连接成一个字符串。<br>原来的数组相当于 [udefined * 3],join(“, “) –&gt; “, , “</p>
<h3 id="33"><a href="#33" class="headerlink" title="33"></a>33</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result of this expression? (or multiple ones)</span><br><span class="line">var a = &#123;class: "Animal", name: 'Fido'&#125;;</span><br><span class="line">a.class</span><br></pre></td></tr></table></figure>
<p>答案: (浏览器)<br>class 是保留字,当在Chrome, Firefox, Opera中的时候,可以被认可,返回Animal, 在IE中的时候..</p>
<h3 id="34"><a href="#34" class="headerlink" title="34"></a>34</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"epoch"</span>)</span><br></pre></td></tr></table></figure>
<p>答案：　Invalid Date<br>Date的四中构造方法, 详见 (<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" rel="external"> –  </a>)</p>
<h3 id="35"><a href="#35" class="headerlink" title="35"></a>35</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">Function</span>.length,</span><br><span class="line">    b = <span class="keyword">new</span> <span class="built_in">Function</span>().length</span><br><span class="line">a === b</span><br></pre></td></tr></table></figure>
<p>答案：　flase<br>It’s false. Function.length is defined to be 1. On the other hand, the length property of the Function prototype object is defined to be 0.</p>
<h3 id="36"><a href="#36" class="headerlink" title="36"></a>36</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">Date</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">[a === b, b === c, a === c]</span><br></pre></td></tr></table></figure>
<p>答案:  [false, false, false]<br>a是字符串,b, c 是Object, 在<code>===</code>操作符面前,不用任何考虑,直接都是false</p>
<h3 id="37"><a href="#37" class="headerlink" title="37"></a>37</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> min = <span class="built_in">Math</span>.min(), max = <span class="built_in">Math</span>.max()</span><br><span class="line">min &lt; max</span><br></pre></td></tr></table></figure>
<p>答案: false<br>Math.min() 返回Infinity, 是javascript的全局对象,代表正的无穷大<br>Math.max() 返回-Infinity 所以…</p>
<h3 id="38"><a href="#38" class="headerlink" title="38"></a>38</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">captureOne</span>(<span class="params">re, str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> match = re.exec(str);</span><br><span class="line">  <span class="keyword">return</span> match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> numRe  = <span class="regexp">/num=(\d+)/ig</span>,</span><br><span class="line">    wordRe = <span class="regexp">/word=(\w+)/i</span>,</span><br><span class="line">    a1 = captureOne(numRe,  <span class="string">"num=1"</span>),</span><br><span class="line">    a2 = captureOne(wordRe, <span class="string">"word=1"</span>),</span><br><span class="line">    a3 = captureOne(numRe,  <span class="string">"NUM=2"</span>),</span><br><span class="line">    a4 = captureOne(wordRe,  <span class="string">"WORD=2"</span>);</span><br><span class="line">[a1 === a2, a3 === a4]</span><br></pre></td></tr></table></figure>
<p>答案: [true, false]<br>Regular expressions in JavaScript if defined using the /g flag will carry a state across matches, even if they are actually used on different strings (the lastIndex property). This means a3 will be null as the regular expression was applied starting from the index of the last matched string, even if it was a different one.</p>
<h3 id="39"><a href="#39" class="headerlink" title="39"></a>39</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"2014-03-19"</span>),</span><br><span class="line">    b = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2014</span>, <span class="number">03</span>, <span class="number">19</span>);</span><br><span class="line">[a.getDay() === b.getDay(), a.getMonth() === b.getMonth()]</span><br></pre></td></tr></table></figure>
<p>答案: [fasle, false]<br>注意b 的构造方法 月份从0开始算,<br>所以a 返回 Wed Mar 19 2014 08:00:00 GMT+0800 (CST)<br>b 返回 Sat Apr 19 2014 00:00:00 GMT+0800 (CST)<br>然后getDay 是返回一个星期中的第几天(从0开始)(这有时候会是个坑)<br>要想返回一个月中的第几天,请使用getDate</p>
<h3 id="40"><a href="#40" class="headerlink" title="40"></a>40</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">'http://giftwrapped.com/picture.jpg'</span>.match(<span class="string">'.gif'</span>)) &#123;</span><br><span class="line">  <span class="string">'a gif file'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="string">'not a gif file'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>答案: a gif file<br>传入的不是一个正则表达式对象,所以会隐式转换成一个正则表达式对象, .gif –&gt; /.gif/<br>匹配的字符串为[“/gif”]</p>
<h3 id="41"><a href="#41" class="headerlink" title="41"></a>41</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">What is the result <span class="keyword">of</span> <span class="keyword">this</span> expression? (or multiple ones)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'bye'</span>;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">[foo(<span class="string">'hello'</span>), bar(<span class="string">'hello'</span>)]</span><br></pre></td></tr></table></figure>
<p>答案:[“hello”, “bye”]<br>Variabled declarations are hoisted, but in this case since the variable exists already in the scope, they are removed altogether. In bar() the variable declaration is removed but the assignment remains, so it has effect.</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这是一套满满都是坑的题目,可能有些认为是钻牛角尖,但也是在开发过程中不能忽视的问题吧..</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/19/JavaScript-Puzzlers/" data-id="cj43j9p2u00003138s72blt1b" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-koa-微信开发(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/31/koa-微信开发(1)/" class="article-date">
  <time datetime="2016-05-30T16:02:51.000Z" itemprop="datePublished">2016-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/31/koa-微信开发(1)/">koa-微信开发(1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="申请公众号"><a href="#申请公众号" class="headerlink" title="申请公众号"></a>申请公众号</h3><p>在 <a href="https://segmentfault.com/img/bVwE8U" target="_blank" rel="external">mp.weixin.qq.com</a> 上根据步骤申请一个账号</p>
<p><img src="/img/bVwE8U" alt="图片描述"></p>
<h3 id="进入公众号"><a href="#进入公众号" class="headerlink" title="进入公众号"></a>进入公众号</h3><p>选择开发–基本配置,进行修改配置</p>
<p><img src="/img/bVwE8W" alt="图片描述"></p>
<h3 id="服务器编写"><a href="#服务器编写" class="headerlink" title="服务器编写"></a>服务器编写</h3><p>根据文档,我们需要做的是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">接入微信公众平台开发，开发者需要按照如下步骤完成：</span><br><span class="line">1、填写服务器配置</span><br><span class="line">2、验证服务器地址的有效性</span><br><span class="line">3、依据接口文档实现业务逻辑</span><br></pre></td></tr></table></figure></p>
<p>当你在配置中写完配置,要提交的时候,微信会对你填写的url发送一个get请求, 包括:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">参数             描述</span><br><span class="line">signature 微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。</span><br><span class="line">timestamp 时间戳</span><br><span class="line">nonce     随机数</span><br><span class="line">echostr   随机字符串</span><br></pre></td></tr></table></figure>
<p>服务器配置如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/wechat'</span>, <span class="function"><span class="keyword">function</span> *(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取微信的请求,注意是 get</span></span><br><span class="line">    <span class="keyword">var</span> signature = <span class="keyword">this</span>.query.signature;</span><br><span class="line">    <span class="keyword">var</span> echostr = <span class="keyword">this</span>.query.echostr;</span><br><span class="line">    <span class="keyword">var</span> timestamp = <span class="keyword">this</span>.query.timestamp;</span><br><span class="line">    <span class="keyword">var</span> nonce = <span class="keyword">this</span>.query.nonce;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里的token 要和你表单上面的token一致</span></span><br><span class="line">    <span class="keyword">var</span> token = <span class="string">'MMDBB'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根文档上面的,我们需要对这三个参数进行字典序排序</span></span><br><span class="line">    <span class="keyword">var</span> arr = [token, timestamp, nonce];</span><br><span class="line">    arr.sort();</span><br><span class="line">    <span class="keyword">var</span> tmpStr = arr.join(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 排序完成之后,需要进行sha1加密, 这里我们使用node.js 自带的crypto模块</span></span><br><span class="line">    <span class="keyword">var</span> sha1 = crypto.createHash(<span class="string">'sha1'</span>);</span><br><span class="line">    sha1.update(tmpStr);</span><br><span class="line">    <span class="keyword">var</span> resStr = sha1.digest(<span class="string">'hex'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(signature, <span class="string">'resStr: '</span>, resStr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开发者获得加密后的字符串可与signature对比，标识该请求来源于微信,</span></span><br><span class="line">    <span class="comment">// 如果匹配,返回echoster , 不匹配则返回error</span></span><br><span class="line">    <span class="keyword">if</span> (resStr === signature) &#123;</span><br><span class="line">        <span class="keyword">this</span>.body = echostr;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="需要注意的点"><a href="#需要注意的点" class="headerlink" title="需要注意的点:"></a>需要注意的点:</h3><ul>
<li>url 的端口必须是80 或者 443</li>
<li>如果验证失败,可以在浏览器的开发者模式下,查看network中的情况</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/31/koa-微信开发(1)/" data-id="cj43j9p3800043138tmk7aop5" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Joursion<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="http://jours.cc" class="mobile-nav-link">关于</a>
  
    <a href="http://blog.csdn.net/xi__long" class="mobile-nav-link">旧博客</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>